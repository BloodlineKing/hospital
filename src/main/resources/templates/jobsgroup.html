<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title>单位分组</title>
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
		<meta name="keywords" content="">
		<meta name="description" content="医疗管理系统，为您提供更优质的服务">
		<link rel="stylesheet" href="css/layui.css">
		<link rel="stylesheet" href="css/global.css">
		<link rel="stylesheet" href="css/jobs.css">
	</head>

	<body>
		<script src="js/nowdate.js" type="text/javascript">
			
		</script>
		<div class="fly-header layui-bg-black">
			<div class="layui-row layui-col-space10">
				<div class="layui-col-md4 layui-col-md-offset5" style="height: 50px;font-size: 26px; line-height: 50px;">
					医疗体检管理系统
				</div>
			</div>
		</div>
		<div class="layui-container layui-row" style="margin-top: 1%;">
			<div class="layui-col-md9">
				欢迎您，尊敬的系统管理员：<label class="username">admin</label>
			</div>
			<div class="layui-col-md3">
				<label id="nowdate"></label>
			</div>
		</div>
		<div class="layui-container fly-marginTop fly-user-main">
			<ul class="layui-nav layui-nav-tree layui-inline" id="child" lay-filter="user">
				<!-- 侧边导航: <ul class="layui-nav layui-nav-tree layui-nav-side"> -->
				<li class="layui-nav-item">
					<a href="javascript:;">体检单位</a>
					<dl class="layui-nav-child">

					</dl>
				</li>
		
			</ul>

			<div class="site-tree-mobile layui-hide">
				<i class="layui-icon">&#xe602;</i>
			</div>
			<div class="site-mobile-shade"></div>

			<div class="site-tree-mobile layui-hide">
				<i class="layui-icon">&#xe602;</i>
			</div>
			<div class="site-mobile-shade"></div>

			<div class="fly-panel fly-panel-user" pad20>
				<div class="layui-col-md-offset4" style="margin-top: 2%;">
					<h2>体检单位分组信息维护</h2>
				</div>
				<div style="margin-top:2%;">
					<form class="layui-form" action="">
						<input  type="hidden" value="" name="unitsId">
						<div class="layui-form-item" style="width: 500px;">
							<label class="layui-form-label">单位名称：</label>
							<div class="layui-input-block" style="width: 500px;">
								<input type="text" name="unitsName" required lay-verify="required" readonly="readonly" placeholder="(只读)" autocomplete="off" class="layui-input">
							</div>
						</div>

						<div class="layui-form-item layui-inline" style="width: 400px;">
							<label class="layui-form-label">分组编号：</label>
							<div class="layui-input-block" style="width: 200px;">
								<input type="text" name="unitsGroupId" placeholder="(只读)" readonly="readonly" autocomplete="off" class="layui-input">
							</div>
						</div>
						<div class="layui-form-item layui-inline" style="width: 400px;">
							<label class="layui-form-label">分组名称：</label>
							<div class="layui-input-block" style="width: 200px;">
								<input type="text" name="groupName" placeholder="(只读)" readonly="readonly" autocomplete="off" class="layui-input">
							</div>
						</div>

						<div class="layui-form-item">
							<label class="layui-form-label">婚姻状况：</label>
							<div class="layui-input-block">
								<input type="radio" name="maritalCondition" value="未婚" title="未婚" checked>
								<input type="radio" name="maritalCondition" value="已婚" title="已婚">
								<input type="radio" name="maritalCondition" value="不限" title="不限">
							</div>
						</div>

						<div class="layui-form-item">
							<label class="layui-form-label">性别：</label>
							<div class="layui-input-block">
								<input type="radio" name="sexCondition" value="男" title="男" checked>
								<input type="radio" name="sexCondition" value="女" title="女">
								<input type="radio" name="sexCondition" value="不限" title="不限">
							</div>
						</div>

						<div class="layui-form-item layui-inline">
							<div class="layui-inline">
								<label class="layui-form-label">年龄上限：</label>
								<div class="layui-input-block" style="width: 200px;">
									<input type="text" name="ageUpperLimit" placeholder="请输入年龄上限" autocomplete="off" class="layui-input">
								</div>
							</div>
							<div class="layui-inline">
								<label class="layui-form-label">年龄下限：</label>
								<div class="layui-input-block" style="width: 200px;">
									<input type="text" name="ageLowerLimit" placeholder="请输入年龄下限" autocomplete="off" class="layui-input">
								</div>
							</div>
						</div>

						<div class="layui-form-item" style="width: 500px;">
							<label class="layui-form-label">职务：</label>
							<div class="layui-input-block" style="width: 500px;">
								<input type="text" name="dutyCondition" required lay-verify="required" placeholder="请输入公司职务" autocomplete="off" class="layui-input">
							</div>
						</div>
						<div>
						<div class="layui-form-item">
							<label class="layui-form-label" >选择套餐：</label>
							<div class="layui-input-block" id="package">
								<select name="package" lay-filter="pid" lay-verify="required">

								</select>
							</div>
						</div>
						<div class="layui-input-block"  id="medical"style="border: solid 1px #C9C9C9;overflow:auto; width: 800px; height: 180px;">

							</div>
					</div>

						<div class="layui-form-item">
							<div class="layui-input-block">
								<button class="layui-btn" lay-submit lay-filter="formDemo" id="save">保存</button>
							</div>
						</div>
					</form>
					<div class="layui-input-block ss">
						<button class="layui-btn">取消</button>
					</div>
					<div class="layui-input-block ss1">
						<button class="layui-btn">打印</button>
					</div>
					<div class="layui-input-block ss2">
						<button class="layui-btn">退出</button>
					</div>

					
				</div>
			</div>

		</div>

		</div>

		<div class="fly-footer">
			<p>
				<a href="http://fly.layui.com/" target="_blank">医疗体检系统</a> 2018 &copy;
				<a href="http://www.layui.com/" target="_blank">多元合创 出品</a>
			</p>
			<p>
				<a href="http://fly.layui.com/jie/2461/" target="_blank">微信公众号</a>
			</p>
		</div>
		<script src="layui.js"></script>
		<script src="js/jobsgroup.js"></script>
	     <script type="text/javascript">
             //窗体加载
             var element;
             var form;
             layui.use(['element','form','layer'], function() {
                 element=layui.element,
					 form=layui.form,
                     $=layui.jquery;
                 getAll();
                 getPackage();

                 var packId= 0;
                 //监听select下拉框
                 form.on('select(pid)',function (data) {
                     if(!isNaN(data.value)){
                         packId=data.value;
                         getPById(data.value);
                     }
                 });

                 $("#save").click(function () {
                     add(packId);
                 })

             });

             //查询全部三级菜单
             function  getAll() {
                     var $ = jQuery = layui.$;
                     $(function () {
                         $.getJSON("http://localhost:8080/getAll.do", {}, function (result) {
                             console.log(result);
                             var content = "";
                             $.each(result, function (i, e) {
                                 content+= "<dd class='layui-nav-item'>" +
                                     "<a href=\"javascript:;\" onclick='getAddId(\""+e.unitsId+"\",\""+e.unitsName +"\")'>" + e.unitsName + "</a>";
                                 $.each(e.groupList,function (i,b) {
                                     if(b.groupName!=undefined) {
                                         content += "<dl class=\"layui-nav-child\">" +
                                             "<dd>" +
                                             "<a href=\"javascript:;\" onclick='getById(\"" + b.unitsGroupId + "\")'>" + b.groupName + "</a>" +
                                             "</dd>" +
                                             "</dl>";
                                     }
                                 })
                                 content+="</dd>";
                             });
                             $(".layui-nav-child").html(content);
                             element.init();
                         });
                     });
             }
             function getAddId(unitsId,unitsName) {
                 var $ = jQuery = layui.$;
                 $("form")[0].reset();
                 $("input[name=unitsName]").val(unitsName);
                 $("input[name=unitsId]").val(unitsId);
                 $(function () {
					 $.get("http://localhost:8080/getMax.do",{"unitsId":unitsId},function (date) {
					     $("input[name=unitsGroupId]").val(date);
                         $("input[name=groupName]").attr("readonly",false);
                         $("input[name=groupName]").attr("placeholder","");
                     },"text");
                 })
             }
             //根据id查询对象
             function  getById(unitsGroupId) {
                     var $ = jQuery = layui.$;
                     //$(form)[0].clear();
                     $(function () {
                         $.getJSON("http://localhost:8080/getById.do",{"unitsGroupId":unitsGroupId},function (date) {
                             $.each(date,function (i,e) {
                                 console.log(e);
                                 $("input[name=unitsName]").val(e.unitsName);
                                 $("input[name=unitsGroupId]").val(e.unitsGroupId);
                                 $("input[name=groupName]").val(e.groupName);
								 $("input[name=unitsId]").val(e.unitsId);
								 $("input[name='maritalCondition'][value='"+e.maritalCondition+"']").prop("checked",true);
								 $("input[name='sexCondition'][value='"+e.sexCondition+"']").prop("checked",true);
								 $("input[name=ageUpperLimit]").val(e.ageUpperLimit);
								 $("input[name=ageLowerLimit]").val(e.ageLowerLimit);
								 $("input[name=dutyCondition]").val(e.dutyCondition);
                                 $("select[name=package]").val(e.packageId);
                                 getPById(e.packageId);
								 form.render();
                             });
                         });
                     });
             };
             //全部套餐
             function  getPackage() {
                 var $ = jQuery = layui.$;
                 $(function () {
					 $.getJSON("http://localhost:8080/getPackage.do",{},function (result) {
					     console.log(result)
                           var content="<option value='请选择'>请选择</option>";
                           $.each(result,function (i,e) {
							   content+="<option value='"+e.packageId+"'>"+e.packageName+"</option>";
                           });
                           $("#package select[name=package]").html(content);
                           element.init();

                     });
                 })
             }
             //所选套餐下的体检组合和体检项目

             function  getPById(packageId) {
                 var $ = jQuery = layui.$;
                 $.getJSON("http://localhost:8080/getPackageMedical.do",{"packageId":packageId},function (date) {
                     var content="";
                     $.each(date,function (i,e) {
                         if(e.medical==null){
                             content+="<div style=\"margin-left:2%;width: 300px; height: 50px; line-height: 50px;\">\n" +
                                 "<a>"+e.com+"</a>"+
                                 "</div>";
                         }else if(e.com==null){
                             content+="<div style=\"margin-left:2%;width: 300px; height: 50px; line-height: 50px;\">\n" +
                                 "<a>"+e.medical+"</a>"+
                                 "</div>";
                         }

                     });
                     $("#medical").html(content);
                 })

             };
             //增加
             function add(packageId) {
                 var $ = jQuery = layui.$;
                 $(function () {
                     var arr=$("form").serialize();
                     console.log(arr);
                     $.get("http://localhost:8080/addGroup.do",arr,function (date) {
                         console.log(date);
                         if($.parseJSON(date).status=="ok"){
                             alert("保存成功!");
                             getAll();
                         }else{
                             alert("保存失败");
                         }
                     })
                 })
             }
		 </script>

	</body>

</html>